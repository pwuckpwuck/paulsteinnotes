<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Paul Stein Notes</title>

  <!-- PapaParse -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      display: grid;
      grid-template-columns: 240px 1fr;
      height: 100vh;
    }

    /* Sidebar */
    aside {
      background: #f7f7f7;
      padding: 20px;
      border-right: 1px solid #ccc;
      overflow-y: auto;
      transition: transform 0.3s ease;
    }

    aside.collapsed {
      transform: translateX(-100%);
    }

    main {
      padding: 20px;
      overflow-y: auto;
    }

    h1 { margin-top: 0; }

    .filter-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 5px; font-weight: 600; }
    select, input[type="text"] { width: 100%; padding: 5px; margin-bottom: 10px; }

    #breadcrumbs {
      font-size: 0.9em;
      margin-bottom: 15px;
      color: #555;
    }

    #breadcrumbs span {
      cursor: pointer;
      color: #0066cc;
    }

    #breadcrumbs span:hover {
      text-decoration: underline;
    }

    .record {
      border-bottom: 1px solid #ddd;
      margin-bottom: 20px;
      padding-bottom: 15px;
    }

    .record-title {
      font-weight: 700;
      font-size: 1.1em;
      margin-bottom: 5px;
      color: #222;
    }

    .record-content {
      font-size: 0.95em;
      color: #444;
      line-height: 1.5;
    }

    .record:last-child { border-bottom: none; }

    /* Mobile hamburger */
    #toggleSidebar {
      display: none;
      position: fixed;
      top: 10px;
      left: 10px;
      background: #0066cc;
      color: white;
      border: none;
      padding: 8px 12px;
      z-index: 1000;
      cursor: pointer;
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      body { grid-template-columns: 1fr; }
      aside { position: fixed; top: 0; left: 0; bottom: 0; width: 240px; z-index: 999; }
      #toggleSidebar { display: block; }
    }
  </style>
</head>
<body>

  <button id="toggleSidebar">☰ Filters</button>

  <aside>
    <h2>Filter</h2>
    <div id="filterContainer"></div>
  </aside>

  <main>
    <h1>Paul Stein Notes </h1>
    <div id="breadcrumbs">Home</div>
    <input type="text" id="keywordSearch" placeholder="Search Title and Content..." />
    <div id="recordsContainer"></div>
  </main>

  <script>
    const toggleBtn = document.getElementById("toggleSidebar");
    const sidebar = document.querySelector("aside");
    toggleBtn.addEventListener("click", () => sidebar.classList.toggle("collapsed"));

    Papa.parse("paul-stein-content1.csv", {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data.filter(row => row.Title && row.Content);
        const filterColumns = ["Year", "Season", "Week", "Author", "Title", "Content Type", "Content"]; // use your actual CSV headers
        const filters = {};

        // Build sidebar filters
        filterColumns.forEach(colName => {
          const uniqueVals = [...new Set(data.map(row => row[colName]).filter(v => v))].sort();
          const group = document.createElement("div");
          group.classList.add("filter-group");

          const label = document.createElement("label");
          label.textContent = colName;

          const select = document.createElement("select");
          select.id = colName + "Filter";

          const allOption = document.createElement("option");
          allOption.value = "";
          allOption.textContent = "All";
          select.appendChild(allOption);

          uniqueVals.forEach(val => {
            const opt = document.createElement("option");
            opt.value = val;
            opt.textContent = val;
            select.appendChild(opt);
          });

          group.appendChild(label);
          group.appendChild(select);
          document.getElementById("filterContainer").appendChild(group);

          filters[colName] = select;
        });

        const recordsContainer = document.getElementById("recordsContainer");
        const keywordInput = document.getElementById("keywordSearch");

        function renderRecords(filteredData) {
          recordsContainer.innerHTML = "";
          if (!filteredData.length) {
            recordsContainer.innerHTML = "<p>No results found.</p>";
            return;
          }
          filteredData.forEach(row => {
            const record = document.createElement("div");
            record.classList.add("record");

            const title = document.createElement("div");
            title.classList.add("record-title");
            title.textContent = row.Title;

            const content = document.createElement("div");
            content.classList.add("record-content");
            content.textContent = row.Content;

            record.appendChild(title);
            record.appendChild(content);
            recordsContainer.appendChild(record);
          });
        }

        function updateBreadcrumbs(filteredData) {
          const crumbs = [];
          crumbs.push(`<span data-type="home">Home</span>`);
          filterColumns.forEach(col => {
            const val = filters[col].value;
            if (val) crumbs.push(`<span data-type="filter" data-col="${col}">${col}: ${val}</span>`);
          });
          if (keywordInput.value.trim()) {
            crumbs.push(`<span data-type="keyword">Search: "${keywordInput.value.trim()}"</span>`);
          }
          document.getElementById("breadcrumbs").innerHTML = crumbs.join(" › ");
        }

        function applyFilters() {
          let filtered = [...data];

          // Apply dropdown filters first
          filterColumns.forEach(col => {
            const val = filters[col].value;
            if (val) filtered = filtered.filter(r => r[col] === val);
          });

          // Then keyword search
          const keyword = keywordInput.value.trim().toLowerCase();
          if (keyword) {
            filtered = filtered.filter(r =>
              r.Title.toLowerCase().includes(keyword) ||
              r.Content.toLowerCase().includes(keyword)
            );
          }

          renderRecords(filtered);
          updateBreadcrumbs(filtered);
        }

        // Event listeners
        Object.values(filters).forEach(select => select.addEventListener("change", applyFilters));
        keywordInput.addEventListener("input", applyFilters);

        document.getElementById("breadcrumbs").addEventListener("click", e => {
          const type = e.target.dataset.type;
          if (!type) return;

          if (type === "home") {
            Object.values(filters).forEach(s => (s.value = ""));
            keywordInput.value = "";
          } else if (type === "filter") {
            const col = e.target.dataset.col;
            filters[col].value = "";
          } else if (type === "keyword") {
            keywordInput.value = "";
          }
          applyFilters();
        });

        // Initial render
        renderRecords(data);
        updateBreadcrumbs(data);
      }
    });
  </script>
</body>
</html>
